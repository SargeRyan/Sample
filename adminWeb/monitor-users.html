<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Hugo 0.84.0">
  <title>Sidebars Â· Bootstrap v5.0</title>

  <!-- <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/sidebars/"> -->
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" />
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
  </style>


  <!-- Custom styles for this template -->
  <link href="sidebars.css" rel="stylesheet">
</head>

<body>

  <main>

    <div class="d-flex flex-column flex-shrink-0 p-3 bg-light" style="width: 280px;">
      <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none">
        <img class="bi me-2" src="/logo.png" width="40" />
        <span class="fs-4">Health Pilot</span>
      </a>
      <hr>
      <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
          <a href="#" class="nav-link link-dark" aria-current="page">
            <ion-icon name="calendar-outline"></ion-icon>
            <span>Dashboard</span>
          </a>
        </li>
        <li>
          <a href="#" class="nav-link  active">
            <ion-icon name="people"></ion-icon>
            <span>Monitor Users</span>
          </a>
        </li>
      </ul>
      <hr>
      <div class="dropdown">
        <a href="#" class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle" id="dropdownUser2"
          data-bs-toggle="dropdown" aria-expanded="false">
          <img src="https://github.com/mdo.png" alt="" width="32" height="32" class="rounded-circle me-2">
          <strong>mdo</strong>
        </a>
        <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser2">
          <li><a class="dropdown-item" href="#">New project...</a></li>
          <li><a class="dropdown-item" href="#">Settings</a></li>
          <li><a class="dropdown-item" href="#">Profile</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" href="#">Sign out</a></li>
        </ul>
      </div>
    </div>

    <div class="b-example-divider"></div>

    <main class="p-4  w-100">
      <div class="d-flex flex-column w-100">
        <h1 class="w-100 mb-5">Monitor Users</h1>
        <div class="w-100 d-flex justify-content-center">
          <div class="spinner-border table-loader mx-auto my-3" role="status">
            <span class="sr-only"></span>
          </div>
        </div>
        <table id="example" class="w-100 table table-striped-costum" style="width:100%">
          <!-- Data Table Data will be inserted here -->
        </table>
      </div>
    </main>

    <!-- Modal -->
    <div class="modal fade" id="manageModal" tabindex="-1" aria-labelledby="manageModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="manageModalLabel">Monitor User</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <section style="background-color: #eee;">
              <div class="container py-5">
                <div class="row">
                  <div class="col-lg-4">
                    <div class="card mb-4">
                      <div class="card-body text-center">
                        <img src="/img/person.svg" alt="avatar" class="img-fluid" style="width: 150px;">
                        <h5 class="my-3" id="userDataName"></h5>
                        <p class="text-muted mb-1" id="userDataAge"></p>
                        <p class="text-muted mb-4" id="userDataGender"></p>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-8">
                    <div class="card mb-4">
                      <div class="card-body" id="userDataContainer">
                        <!-- User Data will be inserted here -->
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </section>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- /#Modal -->

  </main>
  <script src="sidebars.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <script type="module">

    // FIREBASE
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js';
    import { getDatabase, ref, set, get, onValue, child, push } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-storage.js";


    // TODO: Replace the following with your app's Firebase project configuration
    const firebaseConfig = {
      apiKey: "AIzaSyArE3DRbfUpwfpspLhoy36SUhM5dfZaApY",
      authDomain: "healthpilotadmin.firebaseapp.com",
      databaseURL: "https://healthpilotadmin-default-rtdb.firebaseio.com",
      projectId: "healthpilotadmin",
      storageBucket: "healthpilotadmin.appspot.com",
      messagingSenderId: "125018765256",
      appId: "1:125018765256:web:781e003f4ad0afaa86f2fd"
    };
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);

    // Initialize Realtime Database and get a reference to the service
    const database = getDatabase(app);
    const userDataRef = ref(database, '/userData');
    onValue(userDataRef, (snapshot) => {

      var dataSet = []; // data table dateset

      snapshot.forEach((child) => {
        //console.log(child.key, child.val());
        const userStr = child.val();
        const user = JSON.parse(userStr);
        console.log(user);
        let userData = [];
        userData.push(user.name);
        userData.push(user.gender);
        userData.push(user.age);
        userData.push(userStr);
        dataSet.push(userData);
      });
      console.log(dataSet);
      // DATA TABLES
      const table = $('#example').DataTable({
        "bDestroy": true,
        data: dataSet,
        columns: [
          { title: 'Name' },
          { title: 'Gender' },
          { title: 'Age' },
          { title: 'Action' },
        ],
        columnDefs: [
          {
            targets: -1, //-1 targets last column, use 0 for first column
            render: (data) => {
              const strdata = data.replace(/'/g, ' ');
              return `
              <button type="button" data='${strdata}' class="manageBtn btn bg-white border shadow-sm border-secondary" data-bs-toggle="modal" data-bs-target="#manageModal">
                Monitor
              </button>
              `;
            }
          },
        ],
      });

      table.on('click', '.manageBtn', function (e) {
        const userData = JSON.parse($(e.target).attr("data"));
        $("#userDataName").text(userData.name);
        $("#userDataAge").text(`${userData.age} years old`);
        $("#userDataGender").text(userData.gender);
        userData.height = `${userData.height} cm`;
        userData.weight = `${userData.weight} kg`;
        userData.age = `${userData.age} years old`;
        userData.goalWeight = `${userData.goalWeight} kg`;
        const toSkipKeys = ["id", "isSaved"];
        for (const [key, value] of Object.entries(userData)) {
          if (toSkipKeys.includes(key)) continue;
          $("#userDataContainer").append(`
            <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">${pascalToNormal(key)}</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0">${value}</p>
                </div>
              </div>
              <hr>
          `);
        };
        console.log(userData);
      });

      $('#manageModal').on('hidden.bs.modal', function () {
        console.log("Manage Modal Closed");
        $("#userDataContainer").html("");
      })

      $(".table-loader").hide();
    });

    function pascalToNormal(str) {
      return str.replace(/([A-Z])/g, ' $1').replace(/^./, function (str) { return str.toUpperCase(); })
    }
  </script>
</body>

</html>